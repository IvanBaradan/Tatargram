<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tatargram</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Default theme (light) */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .header {
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-weight: 500;
            font-size: 1.5rem;
        }

        /* Theme Selector Styles */
        .theme-selector {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: inherit;
        }

        .theme-selector:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Dark Theme */
        body.dark-theme {
            background-color: #181A20;
            color: #e3eafc;
        }

        body.dark-theme .header {
            background-color: #23272b;
        }

        body.dark-theme .sidebar {
            background-color: #14161a;
            border-right: 1px solid #23272b;
        }

        body.dark-theme .search-box {
            border-bottom: 1px solid #23272b;
        }

        body.dark-theme .search-box input {
            background-color: #23272b;
            border: 1px solid #23272b;
            color: #e3eafc;
        }

        body.dark-theme .chat-item {
            border-bottom: 1px solid #23272b;
        }

        body.dark-theme .chat-item:hover {
            background-color: #181e26;
        }

        body.dark-theme .chat-item.active {
            background-color: #232a34;
        }

        body.dark-theme .chat-title {
            color: #e3eafc;
        }

        body.dark-theme .chat-date {
            color: #b0b8c9;
        }

        body.dark-theme .chat-preview {
            color: #b0b8c9;
        }

        body.dark-theme .main-content {
            background-color: #181A20;
        }

        body.dark-theme .chat-header-main {
            border-bottom: 1px solid #23272b;
        }

        body.dark-theme .chat-title-main {
            color: #e3eafc;
        }

        body.dark-theme .messages-container {
            background-color: #181A20;
        }

        body.dark-theme .message.incoming {
            background-color: #23272b;
            color: #e3eafc;
        }

        body.dark-theme .message.outgoing {
            background-color: #43A047;
        }

        body.dark-theme .input-area {
            border-top: 1px solid #23272b;
        }

        body.dark-theme .message-input {
            background-color: #23272b;
            border: 1px solid #23272b;
            color: #e3eafc;
        }

        body.dark-theme .send-button {
            background-color: #43A047;
        }

        body.dark-theme .send-button:hover {
            background-color: #388E3C;
        }

        body.dark-theme .send-button:disabled {
            background-color: #4a4a4a;
        }

        body.dark-theme .loading {
            color: #b0b8c9;
        }

        body.dark-theme .error {
            background-color: #2d1d20;
            color: #ef9a9a;
            border-bottom: 1px solid #4a2d30;
        }

        body.dark-theme .theme-selector {
            background: rgba(255, 255, 255, 0.1);
        }

        body.dark-theme .theme-selector:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Make theme selector icons lighter in dark theme */
        body.dark-theme .theme-option-icon {
            filter: brightness(1.5);
        }

        body.dark-theme .theme-modal {
            background: rgba(35, 39, 43, 0.95);
            backdrop-filter: blur(10px);
        }

        body.dark-theme .message-time {
            opacity: 0.7;
        }

        body.dark-theme .message-info {
            opacity: 0.6;
            color: #b0b8c9;
        }

        body.dark-theme .sender-name {
            opacity: 0.8;
            color: #b0b8c9;
        }

        /* Custom scrollbar for dark theme */
        body.dark-theme .chat-list::-webkit-scrollbar,
        body.dark-theme .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        body.dark-theme .chat-list::-webkit-scrollbar-track,
        body.dark-theme .messages-container::-webkit-scrollbar-track {
            background: #14161a;
        }

        body.dark-theme .chat-list::-webkit-scrollbar-thumb,
        body.dark-theme .messages-container::-webkit-scrollbar-thumb {
            background: #23272b;
            border-radius: 4px;
        }

        body.dark-theme .chat-list::-webkit-scrollbar-thumb:hover,
        body.dark-theme .messages-container::-webkit-scrollbar-thumb:hover {
            background: #333941;
        }

        /* Teal Theme */
        body.teal-theme {
            background-color: #A1D2D8;
        }

        body.teal-theme .header {
            background-color: #007896ff;
        }

        body.teal-theme .sidebar {
            background-color: #b2ebf2;
            border-right: 1px solid #b2ebf2;
        }

        body.teal-theme .search-box {
            border-bottom: 1px solid #b2ebf2;
        }

        body.teal-theme .search-box input {
            background-color: #b2ebf2;
            border: 1px solid #7fd8d8;
            color: #0f4380ff;
        }

        body.teal-theme .chat-item {
            border-bottom: 1px solid #7fd8d8;
        }

        body.teal-theme .chat-item:hover {
            background-color: #a3d2e0ff;
        }

        body.teal-theme .chat-item.active {
            background-color: #7eb6d6ff;
        }

        body.teal-theme .chat-title {
            color: #0f4380ff;
        }

        body.teal-theme .chat-date {
            color: #005379ff;
        }

        body.teal-theme .chat-preview {
            color: #005379ff;
        }

        body.teal-theme .main-content {
            background-color: #c2e4e7;
        }

        body.teal-theme .chat-header-main {
            border-bottom: 1px solid #b2ebf2;
        }

        body.teal-theme .chat-title-main {
            color: #0f4380ff;
        }

        body.teal-theme .messages-container {
            background-color: #c2e4e7;
        }

        body.teal-theme .message.incoming {
            background-color: #e0f7fa;
            color: #0f4380ff;
        }

        body.teal-theme .message.outgoing {
            background-color: #7fd8d8;
        }

        body.teal-theme .input-area {
            border-top: 1px solid #b2ebf2;
        }

        body.teal-theme .message-input {
            background-color: #b2ebf2;
            border: 1px solid #7fd8d8;
            color: #0f4380ff;
        }

        body.teal-theme .send-button {
            background-color: #7fd8d8;
        }

        body.teal-theme .send-button:hover {
            background-color: #5fb0c9ff;
        }

        body.teal-theme .send-button:disabled {
            background-color: #80cbc4;
        }

        body.teal-theme .theme-selector {
            background: rgba(255, 255, 255, 0.2);
        }

        body.teal-theme .theme-selector:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body.teal-theme .message-time {
            opacity: 0.8;
        }

        body.teal-theme .message-info {
            opacity: 0.7;
            color: #005379ff;
        }

        body.teal-theme .sender-name {
            opacity: 0.9;
            color: #005379ff;
        }

        /* Custom scrollbar for teal theme */
        body.teal-theme .chat-list::-webkit-scrollbar,
        body.teal-theme .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        body.teal-theme .chat-list::-webkit-scrollbar-track,
        body.teal-theme .messages-container::-webkit-scrollbar-track {
            background: #b2ebf2;
        }

        body.teal-theme .chat-list::-webkit-scrollbar-thumb,
        body.teal-theme .messages-container::-webkit-scrollbar-thumb {
            background: #7fd8d8;
            border-radius: 4px;
        }

        body.teal-theme .chat-list::-webkit-scrollbar-thumb:hover,
        body.teal-theme .messages-container::-webkit-scrollbar-thumb:hover {
            background: #5fb0c9ff;
        }

        /* Cappuccino Theme */
        body.cappuccino-theme {
            background-color: #1a1520;
            color: #f0ebf5;
        }

        body.cappuccino-theme .header {
            background-color: #241e2f;
        }

        body.cappuccino-theme .sidebar {
            background-color: #16121a;
            border-right: 1px solid #3d2f47;
        }

        body.cappuccino-theme .search-box {
            border-bottom: 1px solid #3d2f47;
        }

        body.cappuccino-theme .search-box input {
            background-color: #241e2f;
            border: 1px solid #3d2f47;
            color: #f0ebf5;
        }

        body.cappuccino-theme .chat-item {
            border-bottom: 1px solid #3d2f47;
        }

        body.cappuccino-theme .chat-item:hover {
            background-color: #1f1826;
        }

        body.cappuccino-theme .chat-item.active {
            background-color: #2d243a;
        }

        body.cappuccino-theme .chat-title {
            color: #f0ebf5;
        }

        body.cappuccino-theme .chat-date {
            color: #c8b3d6;
        }

        body.cappuccino-theme .chat-preview {
            color: #c8b3d6;
        }

        body.cappuccino-theme .main-content {
            background-color: #1a1520;
        }

        body.cappuccino-theme .chat-header-main {
            border-bottom: 1px solid #3d2f47;
        }

        body.cappuccino-theme .chat-title-main {
            color: #f0ebf5;
        }

        body.cappuccino-theme .messages-container {
            background-color: #1a1520;
        }

        body.cappuccino-theme .message.incoming {
            background-color: #2d243a;
            color: #f0ebf5;
        }

        body.cappuccino-theme .message.outgoing {
            background-color: #4a3d56;
        }

        body.cappuccino-theme .input-area {
            border-top: 1px solid #3d2f47;
        }

        body.cappuccino-theme .message-input {
            background-color: #241e2f;
            border: 1px solid #3d2f47;
            color: #f0ebf5;
        }

        body.cappuccino-theme .send-button {
            background-color: #4a3d56;
        }

        body.cappuccino-theme .send-button:hover {
            background-color: #554262;
        }

        body.cappuccino-theme .send-button:disabled {
            background-color: #7a6b82;
        }

        body.cappuccino-theme .loading {
            color: #c8b3d6;
        }

        body.cappuccino-theme .error {
            background-color: #2d1d20;
            color: #ef9a9a;
            border-bottom: 1px solid #4a2d30;
        }

        body.cappuccino-theme .theme-selector {
            background: rgba(255, 255, 255, 0.1);
        }

        body.cappuccino-theme .theme-selector:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        body.cappuccino-theme .theme-modal-header {
            border-bottom: 1px solid #3d2f47;
            color: #f0ebf5;
        }

        body.cappuccino-theme .theme-option {
            color: #f0ebf5;
        }

        body.cappuccino-theme .theme-option:hover {
            background-color: rgba(74, 61, 86, 0.3);
        }

        body.cappuccino-theme .theme-option-icon {
            color: #f0ebf5;
        }

        body.cappuccino-theme .message-time {
            opacity: 0.7;
        }

        body.cappuccino-theme .message-info {
            opacity: 0.6;
            color: #c8b3d6;
        }

        body.cappuccino-theme .sender-name {
            opacity: 0.8;
            color: #c8b3d6;
        }

        /* Custom scrollbar for cappuccino theme */
        body.cappuccino-theme .chat-list::-webkit-scrollbar,
        body.cappuccino-theme .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        body.cappuccino-theme .chat-list::-webkit-scrollbar-track,
        body.cappuccino-theme .messages-container::-webkit-scrollbar-track {
            background: #16121a;
        }

        body.cappuccino-theme .chat-list::-webkit-scrollbar-thumb,
        body.cappuccino-theme .messages-container::-webkit-scrollbar-thumb {
            background: #2d243a;
            border-radius: 4px;
        }

        body.cappuccino-theme .chat-list::-webkit-scrollbar-thumb:hover,
        body.cappuccino-theme .messages-container::-webkit-scrollbar-thumb:hover {
            background: #3d2f47;
        }

        /* Cyberpunk Theme */
        body.cyberpunk-theme {
            background-color: #000000;
            color: #ffffff;
        }

        body.cyberpunk-theme .header {
            background-color: #0a0a0a;
        }

        body.cyberpunk-theme .sidebar {
            background-color: #000000;
            border-right: 1px solid #333333;
        }

        body.cyberpunk-theme .search-box {
            border-bottom: 1px solid #333333;
        }

        body.cyberpunk-theme .search-box input {
            background-color: #0a0a0a;
            border: 1px solid #333333;
            color: #ffffff;
        }

        body.cyberpunk-theme .chat-item {
            border-bottom: 1px solid #333333;
        }

        body.cyberpunk-theme .chat-item:hover {
            background-color: #111111;
        }

        body.cyberpunk-theme .chat-item.active {
            background-color: #001a00;
        }

        body.cyberpunk-theme .chat-title {
            color: #ffffff;
        }

        body.cyberpunk-theme .chat-date {
            color: #00ff41;
        }

        body.cyberpunk-theme .chat-preview {
            color: #00ff41;
        }

        body.cyberpunk-theme .main-content {
            background-color: #000000;
        }

        body.cyberpunk-theme .chat-header-main {
            border-bottom: 1px solid #333333;
        }

        body.cyberpunk-theme .chat-title-main {
            color: #ffffff;
        }

        body.cyberpunk-theme .messages-container {
            background-color: #000000;
        }

        body.cyberpunk-theme .message.incoming {
            background-color: #0a0a0a;
            color: #ffffff;
        }

        body.cyberpunk-theme .message.outgoing {
            background-color: #00ff41;
            color: #000000;
        }

        body.cyberpunk-theme .input-area {
            border-top: 1px solid #333333;
        }

        body.cyberpunk-theme .message-input {
            background-color: #0a0a0a;
            border: 1px solid #333333;
            color: #ffffff;
        }

        body.cyberpunk-theme .send-button {
            background-color: #00ff41;
            color: #000000;
        }

        body.cyberpunk-theme .send-button:hover {
            background-color: #00cc33;
        }

        body.cyberpunk-theme .send-button:disabled {
            background-color: #666666;
            color: #ffffff;
        }

        body.cyberpunk-theme .loading {
            color: #00ff41;
        }

        body.cyberpunk-theme .error {
            background-color: #2d1d20;
            color: #ff0080;
            border-bottom: 1px solid #4a2d30;
        }

        body.cyberpunk-theme .theme-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #00ff41;
        }

        body.cyberpunk-theme .theme-selector:hover {
            background: rgba(0, 255, 65, 0.2);
            border: 1px solid #00ff41;
        }

        body.cyberpunk-theme .message-time {
            opacity: 0.8;
            color: #00ff41;
        }

        body.cyberpunk-theme .message-info {
            opacity: 0.7;
            color: #00ff41;
        }

        body.cyberpunk-theme .sender-name {
            opacity: 0.9;
            color: #00ff41;
        }

        /* Custom scrollbar for cyberpunk theme */
        body.cyberpunk-theme .chat-list::-webkit-scrollbar,
        body.cyberpunk-theme .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        body.cyberpunk-theme .chat-list::-webkit-scrollbar-track,
        body.cyberpunk-theme .messages-container::-webkit-scrollbar-track {
            background: #000000;
        }

        body.cyberpunk-theme .chat-list::-webkit-scrollbar-thumb,
        body.cyberpunk-theme .messages-container::-webkit-scrollbar-thumb {
            background: #0a0a0a;
            border-radius: 4px;
            border: 1px solid #00ff41;
        }

        body.cyberpunk-theme .chat-list::-webkit-scrollbar-thumb:hover,
        body.cyberpunk-theme .messages-container::-webkit-scrollbar-thumb:hover {
            background: #111111;
        }

        /* Theme Modal Styles */
        .theme-modal {
            display: none;
            position: fixed;
            top: 60px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 10px;
            z-index: 1000;
            min-width: 200px;
        }

        .dark-theme .theme-modal {
            background: rgba(35, 39, 43, 0.95);
            backdrop-filter: blur(10px);
        }

        .teal-theme .theme-modal {
            background: rgba(178, 235, 242, 0.95);
            backdrop-filter: blur(10px);
        }

        .cappuccino-theme .theme-modal {
            background: rgba(36, 30, 47, 0.95);
            backdrop-filter: blur(10px);
        }

        .cyberpunk-theme .theme-modal {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #00ff41;
        }

        .theme-modal-header {
            padding: 10px 15px;
            font-weight: 500;
            border-bottom: 1px solid #eee;
        }

        .dark-theme .theme-modal-header {
            border-bottom: 1px solid #23272b;
        }

        .teal-theme .theme-modal-header {
            border-bottom: 1px solid #7fd8d8;
        }

        .cappuccino-theme .theme-modal-header {
            border-bottom: 1px solid #3d2f47;
            color: #f0ebf5;
        }

        .cyberpunk-theme .theme-modal-header {
            border-bottom: 1px solid #333333;
            color: #00ff41;
        }

        .theme-option {
            background: none;
            border: none;
            padding: 12px 15px;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            width: 100%;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .theme-option:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .dark-theme .theme-option:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .teal-theme .theme-option:hover {
            background-color: rgba(127, 216, 216, 0.2);
        }

        .cappuccino-theme .theme-option:hover {
            background-color: rgba(74, 61, 86, 0.3);
        }

        .cyberpunk-theme .theme-option:hover {
            background-color: rgba(0, 255, 65, 0.1);
        }

        .theme-option-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        /* Reference/Glossary Styles */
        .reference-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 10px;
            color: inherit;
        }

        .reference-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .dark-theme .reference-button {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-theme .reference-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .teal-theme .reference-button {
            background: rgba(255, 255, 255, 0.2);
        }

        .teal-theme .reference-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .cappuccino-theme .reference-button {
            background: rgba(255, 255, 255, 0.1);
        }

        .cappuccino-theme .reference-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .cyberpunk-theme .reference-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #00ff41;
        }

        .cyberpunk-theme .reference-button:hover {
            background: rgba(0, 255, 65, 0.2);
            border: 1px solid #00ff41;
        }

        .reference-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 20px;
            z-index: 1000;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .dark-theme .reference-modal {
            background: rgba(35, 39, 43, 0.95);
            backdrop-filter: blur(10px);
        }

        .teal-theme .reference-modal {
            background: rgba(178, 235, 242, 0.95);
            backdrop-filter: blur(10px);
        }

        .cappuccino-theme .reference-modal {
            background: rgba(36, 30, 47, 0.95);
            backdrop-filter: blur(10px);
        }

        .cyberpunk-theme .reference-modal {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #00ff41;
        }

        .reference-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .dark-theme .reference-modal-header {
            border-bottom: 1px solid #23272b;
        }

        .teal-theme .reference-modal-header {
            border-bottom: 1px solid #7fd8d8;
        }

        .cappuccino-theme .reference-modal-header {
            border-bottom: 1px solid #3d2f47;
            color: #f0ebf5;
        }

        .cyberpunk-theme .reference-modal-header {
            border-bottom: 1px solid #333333;
            color: #00ff41;
        }

        .reference-modal-title {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .reference-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .reference-modal-close:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .dark-theme .reference-modal-close:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .teal-theme .reference-modal-close:hover {
            background-color: rgba(127, 216, 216, 0.2);
        }

        .cappuccino-theme .reference-modal-close:hover {
            background-color: rgba(74, 61, 86, 0.3);
        }

        .cyberpunk-theme .reference-modal-close:hover {
            background-color: rgba(0, 255, 65, 0.1);
        }

        .reference-item {
            margin-bottom: 20px;
        }

        .reference-term {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .reference-definition {
            color: #666;
            line-height: 1.5;
        }

        .dark-theme .reference-definition {
            color: #b0b8c9;
        }

        .teal-theme .reference-definition {
            color: #005379ff;
        }

        .cappuccino-theme .reference-definition {
            color: #c8b3d6;
        }

        .cyberpunk-theme .reference-definition {
            color: #00ff41;
        }

        /* Overlay for modals */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background-color: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            /* Make sidebar resizable */
            resize: horizontal;
            min-width: 200px;
            max-width: 600px;
            overflow: auto;
        }

        /* Resizer handle */
        .sidebar-resizer {
            width: 5px;
            background: #e0e0e0;
            cursor: col-resize;
            transition: background 0.2s;
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 100;
        }

        .sidebar-resizer:hover {
            background: #4CAF50;
        }

        .search-box {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
            transition: border-color 0.3s ease;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
        }

        .chat-item {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .chat-item:hover {
            background-color: #f9f9f9;
        }

        .chat-item.active {
            background-color: #e3f2fd;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .chat-title {
            font-weight: 500;
            font-size: 1rem;
            color: #333;
        }

        .chat-date {
            font-size: 0.75rem;
            color: #999;
        }

        .chat-preview {
            font-size: 0.85rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            transition: background-color 0.3s ease;
        }

        .chat-header-main {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            transition: border-color 0.3s ease;
        }

        .chat-title-main {
            font-weight: 500;
            font-size: 1.1rem;
            color: #333;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            transition: background-color 0.3s ease;
        }

        .message {
            max-width: 70%;
            padding: 10px 14px;
            margin-bottom: 12px;
            border-radius: 18px;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .message.incoming {
            align-self: flex-start;
            background-color: #f0f0f0;
            border-bottom-left-radius: 4px;
        }

        .message.outgoing {
            align-self: flex-end;
            background-color: #4CAF50;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-text {
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .message-info {
            font-size: 0.65rem;
            margin-top: 6px;
            opacity: 0.6;
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 4px;
            opacity: 0.8;
        }

        .sender-name {
            font-size: 0.7rem;
            margin-top: 2px;
            opacity: 0.7;
            font-weight: 500;
        }

        .input-area {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            transition: border-color 0.3s ease;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            outline: none;
            font-size: 1rem;
            resize: none;
            max-height: 150px;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .send-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            margin-left: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .send-button:hover {
            background-color: #43A047;
        }

        .send-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Add styles for sending state */
        .send-button.sending {
            background-color: #43A047;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            color: #666;
        }

        .error {
            padding: 16px;
            background-color: #ffebee;
            color: #c62828;
            text-align: center;
            border-bottom: 1px solid #ffcdd2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Tatargram</h1>
        <div style="display: flex; align-items: center;">
            <button class="reference-button" id="referenceButton" title="Справочник">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="theme-selector" id="themeSelector" title="Сменить тему">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 12H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.07 4.93L17.66 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.34 17.66L4.93 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.07 19.07L17.66 17.66" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.34 6.34L4.93 4.93" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="theme-selector" id="playButton" title="Играть" style="margin-left: 10px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 3L19 12L5 21V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Поиск чатов...">
            </div>
            <div class="chat-list" id="chatList">
                <div class="loading">Загрузка чатов...</div>
            </div>
            <!-- Resizer handle -->
            <div class="sidebar-resizer" id="sidebarResizer"></div>
        </div>
        
        <div class="main-content">
            <div class="chat-header-main" id="chatHeader" style="display: none;">
                <div class="chat-title-main" id="chatTitle"></div>
            </div>
            <div class="messages-container" id="messagesContainer">
                <div class="loading">Выберите чат для начала общения</div>
            </div>
            <div class="input-area" id="inputArea" style="display: none;">
                <textarea class="message-input" id="messageInput" placeholder="Введите сообщение..." rows="1"></textarea>
                <button class="send-button" id="sendButton" disabled>➤</button>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div id="themeModal" class="theme-modal">
        <div class="theme-modal-header">Темы</div>
        <div id="themeOptions">
            <button data-theme="light" class="theme-option">
                <span class="theme-option-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                        <circle cx="12" cy="12" r="5" fill="#333" />
                        <line x1="12" y1="1" x2="12" y2="4" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="12" y1="20" x2="12" y2="23" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="1" y1="12" x2="4" y2="12" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="20" y1="12" x2="23" y2="12" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="4.5" y1="4.5" x2="6.5" y2="6.5" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="17.5" y1="17.5" x2="19.5" y2="19.5" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="4.5" y1="19.5" x2="6.5" y2="17.5" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <line x1="17.5" y1="6.5" x2="19.5" y2="4.5" stroke="#333" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </span>
                <span>Светлая</span>
            </button>
            <button data-theme="dark" class="theme-option">
                <span class="theme-option-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                        <path d="M20.5 15.5a9 9 0 1 1-14-10.5" stroke="#333" stroke-width="2" stroke-linecap="round" fill="none" />
                    </svg>
                </span>
                <span>Тёмная</span>
            </button>
            <button data-theme="teal" class="theme-option">
                <span class="theme-option-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                        <path d="M20 12c0 4.5-3.5 8-8 8s-8-3.5-8-8 3.5-8 8-8" stroke="#333" stroke-width="2" stroke-linecap="round" fill="none" />
                        <path d="M8 16c2.5-1.5 4.5-3.5 6-6" stroke="#333" stroke-width="2" stroke-linecap="round" fill="none" />
                    </svg>
                </span>
                <span>Морская волна</span>
            </button>
            <button data-theme="cappuccino" class="theme-option">
                <span class="theme-option-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                        <path d="M5 12h14" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <path d="M5 8h14" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <path d="M5 16h14" stroke="#333" stroke-width="2" stroke-linecap="round" />
                        <circle cx="12" cy="12" r="8" stroke="#333" stroke-width="2" fill="none" />
                    </svg>
                </span>
                <span>Капучино</span>
            </button>
            <button data-theme="cyberpunk" class="theme-option">
                <span class="theme-option-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle;">
                        <rect x="4" y="4" width="16" height="16" rx="2" stroke="#333" stroke-width="2" fill="none" />
                        <path d="M4 12h16" stroke="#333" stroke-width="2" />
                        <path d="M12 4v16" stroke="#333" stroke-width="2" />
                    </svg>
                </span>
                <span>Киберпанк</span>
            </button>
        </div>
    </div>

    <!-- Reference/Glossary Modal -->
    <div id="referenceModal" class="reference-modal">
        <div class="reference-modal-header">
            <div class="reference-modal-title">Справочник</div>
            <button class="reference-modal-close" id="referenceClose">&times;</button>
        </div>
        <div id="referenceContent">
            <div class="reference-item">
                <div class="reference-term">Чат</div>
                <div class="reference-definition">Разговор между двумя или более участниками. Может быть как личным, так и групповым.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Сообщение</div>
                <div class="reference-definition">Текст, изображение, документ или другой контент, отправленный в чате.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Непрочитанное сообщение</div>
                <div class="reference-definition">Сообщение, которое было получено, но еще не просмотрено пользователем.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Статус "в сети"</div>
                <div class="reference-definition">Показывает, что пользователь в данный момент активен в Telegram.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Форвард</div>
                <div class="reference-definition">Пересланное сообщение от другого пользователя или чата.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Медиа</div>
                <div class="reference-definition">Изображения, видео, аудио, документы и другие файлы, отправленные в сообщениях.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Стикеры</div>
                <div class="reference-definition">Изображения с прозрачным фоном, используемые для выражения эмоций.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Бот</div>
                <div class="reference-definition">Автоматизированная учетная запись, которая выполняет определенные функции в чате.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Канал</div>
                <div class="reference-definition">Односторонний чат, где только администраторы могут публиковать сообщения.</div>
            </div>
            <div class="reference-item">
                <div class="reference-term">Группа</div>
                <div class="reference-definition">Чат с тремя или более участниками, где все могут отправлять сообщения.</div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay"></div>

    <script>
        // Конфигурация API
        const API_BASE = 'http://localhost:8001/api';
        
        // Элементы DOM
        const chatList = document.getElementById('chatList');
        const messagesContainer = document.getElementById('messagesContainer');
        const chatHeader = document.getElementById('chatHeader');
        const chatTitle = document.getElementById('chatTitle');
        const inputArea = document.getElementById('inputArea');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const searchInput = document.getElementById('searchInput');
        const themeSelector = document.getElementById('themeSelector');
        const playButton = document.getElementById('playButton');
        const themeModal = document.getElementById('themeModal');
        const themeOptions = document.querySelectorAll('[data-theme]');
        const referenceButton = document.getElementById('referenceButton');
        const referenceModal = document.getElementById('referenceModal');
        const referenceClose = document.getElementById('referenceClose');
        const modalOverlay = document.getElementById('modalOverlay');
        const sidebar = document.querySelector('.sidebar');
        const sidebarResizer = document.getElementById('sidebarResizer');
        
        // Состояние
        let chats = [];
        let currentChatId = null;
        let currentChatTitle = '';
        let currentTheme = localStorage.getItem('telegramTheme') || 'light';
        let isDemoMode = true; // Always in demo mode for demonstration
        let isResizing = false;
        
        // Apply theme on load
        document.body.className = currentTheme + '-theme';
        
        // Sidebar resizing functionality
        sidebarResizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        });
        
        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            const newWidth = e.clientX - containerRect.left;
            
            // Limit the width between 200px and 600px
            if (newWidth >= 200 && newWidth <= 600) {
                sidebar.style.width = newWidth + 'px';
            }
        });
        
        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        });
        
        // Theme selector functionality
        themeSelector.addEventListener('click', (e) => {
            e.stopPropagation();
            if (themeModal.style.display === 'block') {
                themeModal.style.display = 'none';
                modalOverlay.style.display = 'none';
            } else {
                themeModal.style.display = 'block';
                modalOverlay.style.display = 'block';
                referenceModal.style.display = 'none';
            }
        });
        
        // Reference modal functionality
        referenceButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (referenceModal.style.display === 'block') {
                referenceModal.style.display = 'none';
                modalOverlay.style.display = 'none';
            } else {
                referenceModal.style.display = 'block';
                modalOverlay.style.display = 'block';
                themeModal.style.display = 'none';
            }
        });
        
        // Close modals when clicking overlay
        modalOverlay.addEventListener('click', () => {
            themeModal.style.display = 'none';
            referenceModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });
        
        // Close reference modal with close button
        referenceClose.addEventListener('click', () => {
            referenceModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });
        
        // Theme selection
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                const theme = option.getAttribute('data-theme');
                currentTheme = theme;
                localStorage.setItem('telegramTheme', theme);
                document.body.className = theme + '-theme';
                themeModal.style.display = 'none';
                modalOverlay.style.display = 'none';
            });
        });
        
        // Play button functionality
        playButton.addEventListener('click', () => {
            // Pass the current theme to the game page
            const currentTheme = localStorage.getItem('telegramTheme') || 'light';
            window.location.href = `tatar_game.html?theme=${currentTheme}`;
        });
        
        // Форматирование даты для отображения
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            
            // Если сегодня
            if (date.toDateString() === now.toDateString()) {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
            
            // Если вчера
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            if (date.toDateString() === yesterday.toDateString()) {
                return 'Вчера';
            }
            
            // Если в этом году
            if (date.getFullYear() === now.getFullYear()) {
                return date.toLocaleDateString([], { month: 'short', day: 'numeric' });
            }
            
            // В противном случае
            return date.toLocaleDateString([], { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        // Генерация мок данных для чатов
        function generateMockChats() {
            const mockChats = [
                {
                    id: '1',
                    name: 'Алексей Иванов',
                    title: 'Алексей Иванов',
                    last_message: 'Привет! Как дела?',
                    last_message_date: new Date(Date.now() - 3600000).toISOString() // 1 час назад
                },
                {
                    id: '2',
                    name: 'Мария Петрова',
                    title: 'Мария Петрова',
                    last_message: 'Отправил тебе документы',
                    last_message_date: new Date(Date.now() - 86400000).toISOString() // 1 день назад
                },
                {
                    id: '3',
                    name: 'Команда проекта',
                    title: 'Команда проекта',
                    last_message: 'Алексей: Встреча перенесена на 15:00',
                    last_message_date: new Date(Date.now() - 172800000).toISOString() // 2 дня назад
                },
                {
                    id: '4',
                    name: 'Служба поддержки',
                    title: 'Служба поддержки',
                    last_message: 'Ваш запрос обрабатывается',
                    last_message_date: new Date(Date.now() - 259200000).toISOString() // 3 дня назад
                },
                {
                    id: '5',
                    name: 'Елена Сидорова',
                    title: 'Елена Сидорова',
                    last_message: 'Спасибо за помощь!',
                    last_message_date: new Date(Date.now() - 345600000).toISOString() // 4 дня назад
                },
                {
                    id: '6',
                    name: 'Отдел разработки',
                    title: 'Отдел разработки',
                    last_message: 'Новая версия приложения готова',
                    last_message_date: new Date(Date.now() - 432000000).toISOString() // 5 дней назад
                },
                {
                    id: '7',
                    name: 'Игорь Николаев',
                    title: 'Игорь Николаев',
                    last_message: 'Увидимся завтра',
                    last_message_date: new Date(Date.now() - 518400000).toISOString() // 6 дней назад
                },
                {
                    id: '8',
                    name: 'Анна Кузнецова',
                    title: 'Анна Кузнецова',
                    last_message: 'Проверь почту, отправил файлы',
                    last_message_date: new Date(Date.now() - 604800000).toISOString() // 7 дней назад
                },
                {
                    id: '9',
                    name: 'Группа друзей',
                    title: 'Группа друзей',
                    last_message: 'Кто идет на концерт?',
                    last_message_date: new Date(Date.now() - 691200000).toISOString() // 8 дней назад
                },
                {
                    id: '10',
                    name: 'Бот уведомлений',
                    title: 'Бот уведомлений',
                    last_message: 'Напоминание: встреча через 1 час',
                    last_message_date: new Date(Date.now() - 777600000).toISOString() // 9 дней назад
                }
            ];
            
            return mockChats;
        }
        
        // Генерация мок сообщений для чата
        function generateMockMessages(chatId) {
            const messages = [];
            const chatNames = {
                '1': 'Алексей Иванов',
                '2': 'Мария Петрова',
                '3': 'Команда проекта',
                '4': 'Служба поддержки',
                '5': 'Елена Сидорова',
                '6': 'Отдел разработки',
                '7': 'Игорь Николаев',
                '8': 'Анна Кузнецова',
                '9': 'Группа друзей',
                '10': 'Бот уведомлений'
            };
            
            const chatName = chatNames[chatId] || 'Неизвестный';
            const isGroupChat = ['3', '6', '9'].includes(chatId); // Team, Development Dept, Friends Group
            
            // Добавляем несколько сообщений
            messages.push({
                text_content: `Привет! Это тестовое сообщение от ${chatName}`,
                date: new Date(Date.now() - 3600000).toISOString(),
                from_me: false,
                sender_name: isGroupChat ? 'Алексей' : null
            });
            
            messages.push({
                text_content: 'Привет! Как у тебя дела?',
                date: new Date(Date.now() - 3500000).toISOString(),
                from_me: true
            });
            
            messages.push({
                text_content: 'У меня все хорошо, спасибо! А у тебя?',
                date: new Date(Date.now() - 3400000).toISOString(),
                from_me: false,
                sender_name: isGroupChat ? 'Мария' : null
            });
            
            messages.push({
                text_content: 'Тоже неплохо. Работаю над новым проектом.',
                date: new Date(Date.now() - 3300000).toISOString(),
                from_me: true
            });
            
            messages.push({
                text_content: 'Отлично! Удачи с проектом!',
                date: new Date(Date.now() - 3200000).toISOString(),
                from_me: false,
                sender_name: isGroupChat ? 'Петр' : null
            });
            
            // Добавляем больше сообщений для некоторых чатов
            if (chatId === '3') {
                messages.push({
                    text_content: 'Не забудьте про встречу сегодня в 15:00',
                    date: new Date(Date.now() - 3100000).toISOString(),
                    from_me: false,
                    sender_name: 'Дмитрий'
                });
                
                messages.push({
                    text_content: 'Да, обязательно буду',
                    date: new Date(Date.now() - 3000000).toISOString(),
                    from_me: true
                });
            }
            
            if (chatId === '9') {
                messages.push({
                    text_content: 'Кто хочет пойти на концерт?',
                    date: new Date(Date.now() - 2900000).toISOString(),
                    from_me: false,
                    sender_name: 'Сергей'
                });
                
                messages.push({
                    text_content: 'Я пойду!',
                    date: new Date(Date.now() - 2800000).toISOString(),
                    from_me: true
                });
                
                messages.push({
                    text_content: 'Я тоже!',
                    date: new Date(Date.now() - 2700000).toISOString(),
                    from_me: false,
                    sender_name: 'Ольга'
                });
            }
            
            return messages;
        }
        
        // Отображение списка чатов
        function renderChatList(chatsToRender) {
            console.log('Rendering chat list with:', chatsToRender);
            if (!chatList) {
                console.error('chatList element not found');
                return;
            }
            
            if (!chatsToRender || chatsToRender.length === 0) {
                chatList.innerHTML = '<div class="loading">Чаты не найдены</div>';
                return;
            }
            
            // Clear the loading message
            chatList.innerHTML = '';
            
            chatsToRender.forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatElement.innerHTML = `
                    <div class="chat-header">
                        <div class="chat-title">${chat.name || chat.title}</div>
                        <div class="chat-date">${formatDate(chat.last_message_date)}</div>
                    </div>
                    <div class="chat-preview">${chat.last_message || 'Сообщений пока нет'}</div>
                `;
                
                chatElement.addEventListener('click', () => selectChat(chat.id, chat.name || chat.title));
                chatList.appendChild(chatElement);
            });
            console.log('Finished rendering chat list');
        }
        
        // Выбор чата
        async function selectChat(chatId, title) {
            currentChatId = chatId;
            currentChatTitle = title;
            
            // Обновление UI
            chatTitle.textContent = title;
            chatHeader.style.display = 'flex';
            inputArea.style.display = 'flex';
            messagesContainer.innerHTML = '<div class="loading">Загрузка сообщений...</div>';
            
            // Always load mock messages for demonstration
            const mockMessages = generateMockMessages(chatId);
            renderMessages(mockMessages);
        }
        
        // Отображение сообщений
        function renderMessages(messages) {
            if (messages.length === 0) {
                messagesContainer.innerHTML = '<div class="loading">Сообщений пока нет</div>';
                return;
            }
            
            messagesContainer.innerHTML = '';
            
            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${msg.from_me ? 'outgoing' : 'incoming'}`;
                
                // For group chats, we might want to show the sender's name
                const senderName = msg.sender_name || (msg.from_me ? '' : 'Собеседник');
                
                // Create message info with sender name and timestamp on the same line (below message text)
                let messageInfo = '';
                if (senderName && !msg.from_me) {
                    messageInfo = `<div class="message-info">${senderName} ${formatDate(msg.created_at || msg.date)}</div>`;
                } else {
                    messageInfo = `<div class="message-info">${formatDate(msg.created_at || msg.date)}</div>`;
                }
                
                messageElement.innerHTML = `
                    <div class="message-text">${msg.text_content || msg.text}</div>
                    ${messageInfo}
                `;
                messagesContainer.appendChild(messageElement);
            });
            
            // Прокрутка вниз
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Отправка сообщения
        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentChatId) return;
            
            // Add sending state visual feedback
            sendButton.classList.add('sending');
            
            // Отключение ввода во время отправки
            messageInput.disabled = true;
            
            try {
                // Add the message locally
                const newMessage = {
                    text_content: text,
                    date: new Date().toISOString(),
                    from_me: true
                };
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message outgoing';
                messageElement.innerHTML = `
                    <div class="message-text">${text}</div>
                    <div class="message-time">${formatDate(newMessage.date)}</div>
                `;
                messagesContainer.appendChild(messageElement);
                
                // Прокрутка вниз
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Очистка ввода
                messageInput.value = '';
                messageInput.dispatchEvent(new Event('input'));
                
                // Update the chat list to show this message as the last message
                const chatIndex = chats.findIndex(chat => chat.id === currentChatId);
                if (chatIndex !== -1) {
                    chats[chatIndex].last_message = text;
                    chats[chatIndex].last_message_date = newMessage.date;
                    // Re-render chat list to show updated message
                    renderChatList(chats);
                }
            } catch (error) {
                console.error('Error sending message:', error);
                // Even if there's an error, we still want to clear the input
                messageInput.value = '';
                messageInput.dispatchEvent(new Event('input'));
            } finally {
                // Remove sending state visual feedback
                sendButton.classList.remove('sending');
                messageInput.disabled = false;
                messageInput.focus();
            }
        }
        
        // Загрузка чатов
        async function loadChats() {
            try {
                console.log('Loading chats...');
                // Always load mock data for demonstration
                chats = generateMockChats();
                console.log('Generated mock chats:', chats);
                renderChatList(chats);
                console.log('Rendered chat list');
            } catch (error) {
                console.error('Error loading chats:', error);
                if (chatList) {
                    chatList.innerHTML = '<div class="error">Ошибка загрузки чатов</div>';
                }
            }
        }
        
        // Фильтрация чатов по поиску
        let searchTimeout;
        function filterChats() {
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            // Set a new timeout to delay the search
            searchTimeout = setTimeout(() => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                if (!searchTerm) {
                    renderChatList(chats);
                    return;
                }
                
                const filtered = chats.filter(chat => 
                    (chat.name && chat.name.toLowerCase().includes(searchTerm)) ||
                    (chat.title && chat.title.toLowerCase().includes(searchTerm)) ||
                    (chat.last_message && chat.last_message.toLowerCase().includes(searchTerm))
                );
                
                renderChatList(filtered);
            }, 300); // 300ms delay
        }
        
        // Attach search event listener
        searchInput.addEventListener('input', filterChats);
        
        // Attach send button event listener
        sendButton.addEventListener('click', sendMessage);
        
        // Allow sending message with Enter key (but not Shift+Enter for new line)
        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!sendButton.disabled) {
                    sendMessage();
                }
            }
        });
        
        // Автоматическое изменение размера текстовой области
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight > 150 ? 150 : this.scrollHeight) + 'px';
            // Enable/disable send button based on input
            sendButton.disabled = !this.value.trim();
        });
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing...');
            // Check if required elements exist
            if (!chatList) {
                console.error('chatList element not found');
                return;
            }
            
            if (!statusElement) {
                console.warn('statusElement not found, continuing without it');
            }
            
            // Small delay to ensure DOM is fully loaded
            setTimeout(async () => {
                console.log('Loading chats after delay...');
                await loadChats();
                
                // Обновление чатов каждые 30 секунд
                setInterval(loadChats, 30000);
            }, 100);
        });
        
        // Fallback in case DOMContentLoaded doesn't fire
        setTimeout(async () => {
            if (chatList && chats.length === 0) {
                console.log('Fallback: Loading chats...');
                await loadChats();
            }
        }, 500);
        
        // Additional fallback to ensure chats are loaded
        setTimeout(async () => {
            if (chatList && chats.length === 0) {
                console.log('Additional fallback: Loading chats...');
                await loadChats();
            }
        }, 2000);
        
        // Immediate load for demonstration purposes
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', async () => {
                if (chats.length === 0) {
                    await loadChats();
                }
            });
        } else {
            // DOM is already loaded
            if (chats.length === 0) {
                loadChats();
            }
        }
    </script>
</body>
</html>
